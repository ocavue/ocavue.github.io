<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>格式校验利器：JSON Schema 简介 | Ocavue&#39;s Blog</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/assets/css/0.styles.c77a0a89.css" as="style"><link rel="preload" href="/assets/js/app.3390545e.js" as="script"><link rel="preload" href="/assets/js/7.4335dcfb.js" as="script"><link rel="preload" href="/assets/js/14.2c8898b5.js" as="script"><link rel="prefetch" href="/assets/js/10.3cc39aa1.js"><link rel="prefetch" href="/assets/js/11.ac7ff37e.js"><link rel="prefetch" href="/assets/js/12.6f0b04a4.js"><link rel="prefetch" href="/assets/js/13.8586ab88.js"><link rel="prefetch" href="/assets/js/15.07692fc6.js"><link rel="prefetch" href="/assets/js/16.0fd9f730.js"><link rel="prefetch" href="/assets/js/17.62e65e2b.js"><link rel="prefetch" href="/assets/js/18.56cc483b.js"><link rel="prefetch" href="/assets/js/2.cdefbf3e.js"><link rel="prefetch" href="/assets/js/3.b05d599e.js"><link rel="prefetch" href="/assets/js/4.e52bb422.js"><link rel="prefetch" href="/assets/js/5.13d50fda.js"><link rel="prefetch" href="/assets/js/6.5bab4f56.js"><link rel="prefetch" href="/assets/js/8.da20465b.js"><link rel="prefetch" href="/assets/js/9.cc10bcad.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c77a0a89.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="root"><span class="cover" data-v-1164ecfe></span> <div class="sidebar" data-v-cf3bad4a><div class="sidebar__header" data-v-cf3bad4a><a href="/about.html" class="sidebar__header-avatar" style="background-image:url(https://ws1.sinaimg.cn/large/006tNc79gy1fom9qicqcej30e80e83zo.jpg);" data-v-cf3bad4a></a></div> <nav class="sidebar__nav" data-v-cf3bad4a><a href="/" class="sidebar__nav-item router-link-active" data-v-cf3bad4a><span class="sidebar__nav-item-icon icon-home" data-v-cf3bad4a></span> <span class="sidebar__nav-item-content" data-v-cf3bad4a>HOME</span></a> <a href="/about.html" class="sidebar__nav-item" data-v-cf3bad4a><span class="sidebar__nav-item-icon icon-face" data-v-cf3bad4a></span> <span class="sidebar__nav-item-content" data-v-cf3bad4a>ABOUT</span></a> <a href="/tag/" class="sidebar__nav-item" data-v-cf3bad4a><span class="sidebar__nav-item-icon icon-tag" data-v-cf3bad4a></span> <span class="sidebar__nav-item-content" data-v-cf3bad4a>TAGS</span></a></nav></div> <div class="toc" data-v-ea388812><a href="#json-是什么" class="toc__item" style="padding-left:16px;" data-v-ea388812>
        JSON 是什么
    </a><a href="#json-schema-是什么？" class="toc__item" style="padding-left:16px;" data-v-ea388812>
        JSON Schema 是什么？
    </a><a href="#understanding-json-schema" class="toc__item" style="padding-left:16px;" data-v-ea388812>
        Understanding JSON Schema
    </a><a href="#版本" class="toc__item" style="padding-left:16px;" data-v-ea388812>
        版本
    </a><a href="#总结" class="toc__item" style="padding-left:16px;" data-v-ea388812>
        总结
    </a></div> <header class="toolbar" data-v-5fd7a81e><span class="toolbar__button icon-menu" data-v-5fd7a81e></span> <a href="/" class="toolbar__item router-link-active" data-v-5fd7a81e>
        Ocavue's Blog
    </a> <span style="flex: 1;" data-v-5fd7a81e></span> <span class="toolbar__button icon-toc" data-v-5fd7a81e></span></header> <main class="app__main"><div class="post" data-v-a962948a><a href="/jsonschema.html" class="router-link-exact-active router-link-active post__img post__img--nolink" style="background-image:linear-gradient(to bottom, rgba(0, 0, 0, 0.05) 0%, rgba(0, 0, 0, 0.60) 100%), url('https://i.loli.net/2019/05/06/5ccfe8a9beebb.jpg');" data-v-a962948a><span class="post__img-title" data-v-a962948a>
            格式校验利器：JSON Schema 简介
        </span> <span class="post__img-info" data-v-a962948a><span data-v-a962948a>2018-07-23</span></span></a> <div class="post__content markdown-body" data-v-a962948a><div class="content default"><h2 id="json-是什么"><a href="#json-是什么" aria-hidden="true" class="header-anchor">#</a> JSON 是什么</h2> <p><strong>JSON</strong>，全称 <strong>J</strong>ava<strong>S</strong>cript <strong>O</strong>bject <strong>N</strong>otation. 是 JS 的数据结构的子集。相信大家对 JSON 也非常熟悉了。JSON 一共只有六种数据结构，这里列举他们在 JS 和 Python 中的叫法以及在 JSON 中的例子：</p> <table><thead><tr><th>JS</th> <th>Python3</th> <th>JSON</th></tr></thead> <tbody><tr><td>string</td> <td>string</td> <td><code>&quot;ABC&quot;</code></td></tr> <tr><td>number</td> <td>int/float</td> <td><code>123</code> <code>-1.23</code></td></tr> <tr><td>boolean</td> <td>bool</td> <td><code>true</code> <code>false</code></td></tr> <tr><td>null</td> <td>None</td> <td><code>null</code></td></tr> <tr><td>object</td> <td>dictnu</td> <td><code>{&quot;key&quot;: &quot;value&quot;}</code></td></tr> <tr><td>array</td> <td>list</td> <td><code>[&quot;ABC&quot;, 123, true]</code></td></tr></tbody></table> <p>由于 JSON 是 JS 语法的子集，所以下文中我都会使用 JS 的称呼。</p> <p>得益于 JSON 极致的简单<s>和 JS 的广泛使用</s>，JSON 很快流行了起来。但是简单也有简单的坏处，人们逐渐发现 JSON 缺少一些必要的功。</p> <h2 id="json-schema-是什么？"><a href="#json-schema-是什么？" aria-hidden="true" class="header-anchor">#</a> JSON Schema 是什么？</h2> <p>当前后端使用 JSON 通信的时候，双方需要验证 JSON 的数据格式，比如验证 array 的长度、number 的大小、甚至于类似 object 中有某两个属性不能并存等等要求。当然这些规则都可以使用代码进行验证，但是这样写起来太繁琐了，所以为了<strong>描述并校验 JSON 的格式</strong>，JSON Schema 诞生了。</p> <p>这里有一个非常简单的 JSON Schema 的例子：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;$schema&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://json-schema.org/draft-04/schema#&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span>  <span class="token punctuation">{</span> <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    	<span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;integer&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;minimum&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">&quot;exclusiveMinimum&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    	<span class="token property">&quot;telephone&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;pattern&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^(\\([0-9]{3}\\))?[0-9]{3}-[0-9]{4}$&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;additionalProperties&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面这个 JSON 描述了这样的一个 JSON：</p> <ul><li>类型是 object</li> <li>有四个属性：
<ul><li>name：
<ul><li>类型为 string</li></ul></li> <li>email：
<ul><li>类型为 string</li></ul></li> <li>Age：
<ul><li>类型为整数</li> <li>这个整数要大于等于 0</li></ul></li> <li>telephone：
<ul><li>类型为 string</li> <li>需要符合这个正则表达式</li></ul></li></ul></li> <li>上面这四个属性中必须出现有的 name 和 email，剩下的两个是可选的</li> <li>除了这四个属性外，不允许出现其他属性</li></ul> <p>比如说，这样的一个 JSON 就符合这些要求：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Sherlock Holmes&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sherlock@gmail.com&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">164</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到，JSON Schema 本身也是一个 JSON。同一个 JSON，<s>同一个世界</s>前后端都能看懂，那么的话这个 JSON Schema 就既可以作为执行代码，又可以作为文档。这种统一确保了代码和文档不会脱节，省去了写文档的功夫。毕竟程序员最讨厌的就是没有文档的代码和写文档了。</p> <h2 id="understanding-json-schema"><a href="#understanding-json-schema" aria-hidden="true" class="header-anchor">#</a> Understanding JSON Schema</h2> <p>在这里，<strong>我强烈推荐阅读 <a href="https://spacetelescope.github.io/understanding-json-schema/#understanding-json-schema" target="_blank" rel="noopener noreferrer">Understanding JSON Schema<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong>，以至于我要专门写一章来介绍它。这是一个非常适合初学者的教程，有着及其清晰的例子。虽然截止写稿时其版本还停留在 draft-04，不过瑕不掩瑜，依然是我心中最优秀的 JSON Schema 教程。</p> <p>在这里列一下 Understanding JSON Schema 的大纲，方便查漏补缺：</p> <ul><li>Type-specific keywords
<ul><li><code>string</code> <ul><li><code>minLength</code></li> <li><code>maxLength</code></li> <li><code>pattern</code></li></ul></li> <li>Numeric types
<ul><li>types: <code>integer</code>, <code>number</code></li> <li><code>multipleOf</code></li> <li>range: <code>minimum</code>, <code>exclusiveMinimum</code>, <code>maximum</code>, <code>exclusiveMaximum</code></li></ul></li> <li><code>object</code> <ul><li><code>properties</code></li> <li><code>additionalProperties</code></li> <li><code>required</code></li> <li>size: <code>minProperties</code>, <code>maxProperties</code></li> <li><code>dependencies</code></li> <li><code>patternProperties</code></li></ul></li> <li><code>array</code> <ul><li><code>items</code></li> <li>length: <code>minItems</code>, <code>maxItems</code></li> <li><code>uniqueItems</code></li></ul></li> <li><code>boolean</code></li> <li><code>null</code></li></ul></li> <li>Generic keywords
<ul><li>Metadata: <code>title</code>, <code>description</code>, <code>default</code></li> <li>Enumerated values: <code>enum</code></li></ul></li> <li>Combining schemas
<ul><li><code>allOf</code></li> <li><code>anyOf</code></li> <li><code>oneOf</code></li> <li><code>not</code></li></ul></li> <li>The <code>$schema</code> keyword</li> <li>Regular Expressions</li></ul> <h2 id="版本"><a href="#版本" aria-hidden="true" class="header-anchor">#</a> 版本</h2> <p>截止到今天，JSON Schema 一共有 7 个版本，最新的是 draft-07。不同版本之间并不（完全）兼容，所以最佳实践是在写 JSON Schema 的时候使用 <code>$schema</code> 关键字标记当前使用的是哪个规范。</p> <p>下面举个例子，展示了 draft-04 和 draft-06 中「大于」和「大于等于」写法：</p> <p>大于：</p> <div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;$schema&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://json-schema.org/draft-06/schema#&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;exclusiveMinimum&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;$schema&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://json-schema.org/draft-04/schema#&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;minimum&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;exclusiveMinimum&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><p>大于等于：</p> <div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;$schema&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://json-schema.org/draft-06/schema#&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;minimum&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;$schema&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://json-schema.org/draft-04/schema#&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;minimum&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;exclusiveMinimum&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em>注：在 draft-04 中，<code>exclusiveMinimum</code> 的默认值就是 <code>false</code>，所以可以不写。</em></p> <p>在 draft-04 中，<code>exclusiveMinimum</code> 的值是 <code>boolean</code>，draft-06 中改成了 <code>number</code>。在相同含义的情况下，新版的写法的确更加简洁。</p> <p>关于不同版本之间的区别可以查看官网的 <a href="http://json-schema.org/specification.html#migrating-from-older-drafts" target="_blank" rel="noopener noreferrer">Migrating from older drafts<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 一节。</p> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>JSON Schema 作为一个验证 JSON 的通用语法，我认为它成功完成了自己的任务。虽然有一些诸如可读性不高，写法繁琐的缺点，但是我认为这些都是必要的妥协。</p> <blockquote><p>评论功能还未上线，大家可以去<a href="https://juejin.im/post/5b5533e3e51d45195c0747b8" target="_blank" rel="noopener noreferrer">掘金<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>评论本文。</p></blockquote> <hr> <p><img src="https://i.creativecommons.org/l/by-nc-nd/2.5/cn/88x31.png" alt="知识共享协议"></p> <p>本文采用<a href="http://creativecommons.org/licenses/by-nc-nd/2.5/cn/" target="_blank" rel="noopener noreferrer">知识共享署名-非商业性使用-禁止演绎 2.5 中国大陆许可协议<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>进行许可。</p></div></div></div></main> <footer class="app__footer">
        Power by <a href="https://github.com/ocavue/vuepress-theme-blogue" class="app__footer-link">Blogue</a></footer> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.3390545e.js" defer></script><script src="/assets/js/7.4335dcfb.js" defer></script><script src="/assets/js/14.2c8898b5.js" defer></script>
  </body>
</html>
