(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{192:function(t,s,a){"use strict";a.r(s);var e=a(1),n=Object(e.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("今天给大家介绍的是 python 包管理工具 Pipenv。在 Python 的"),a("a",{attrs:{href:"https://packaging.python.org/guides/tool-recommendations/#application-dependency-management",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),a("OutboundLink")],1),t._v("中，有这么一段话：")]),t._v(" "),a("blockquote",[a("p",[t._v("Use Pipenv to manage library dependencies when developing Python applications ... Consider other tools such as "),a("code",[t._v("pip")]),t._v(" when "),a("code",[t._v("pipenv")]),t._v(" "),a("strong",[t._v("does not")]),t._v(' meet your use case."')])]),t._v(" "),a("p",[t._v("也就是说 Python 官方认为 Pipenv 比 pip 更加适合一般的用户。作为一个第三方工具，能从官方获得如此高的评价实属不易。这篇文章就向大家简要介绍一下这个工具。")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://wx2.sinaimg.cn/large/663aa05agy1fvf37wijb0g20rb0r2q4t.gif",alt:"xkcd: Python Environment"}})]),t._v(" "),a("blockquote",[a("p",[t._v("↑ xkcd: Python Environment")])]),t._v(" "),a("h2",{attrs:{id:"背景知识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景知识","aria-hidden":"true"}},[t._v("#")]),t._v(" 背景知识")]),t._v(" "),a("p",[t._v("在进入主题之前，首先我们要区分 Pythpn 社区中几个名字非常类似的工具。这里推荐 "),a("a",{attrs:{href:"https://stackoverflow.com/a/41573588/9426588",target:"_blank",rel:"noopener noreferrer"}},[t._v("stackoverflow 上 Flimm 的回答"),a("OutboundLink")],1),t._v("，讲的十分清楚了。摘抄翻译一下本文会讲到的几个工具：")]),t._v(" "),a("blockquote",[a("ul",[a("li",[t._v("PyPI 中的非标准库\n"),a("ul",[a("li",[a("strong",[a("a",{attrs:{href:"https://pypi.python.org/pypi/virtualenv",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("virtualenv")]),a("OutboundLink")],1)]),t._v(" 是一个非常流行的、用来创建虚拟环境的工具。如果你不熟悉这个工具，我强烈推荐你去学习一下，因为它真的非常有用。接下来的回答中我都会拿他进行对比。\n它的原理是在一个目录下（比如："),a("code",[t._v("env/")]),t._v("）安装很多文件，然后在 "),a("code",[t._v("PATH")]),t._v(" 环境变量的前面加上一个自定义的 "),a("code",[t._v("bin")]),t._v(" 目录（比如："),a("code",[t._v("env/bin")]),t._v("）。一个完整的 "),a("code",[t._v("python")]),t._v(" 或者 "),a("code",[t._v("python3")]),t._v(" 二进制文件会放入这个目录中，Python 被设计成先在相对它的路径处寻找库。它不是 Python 标准库的一部分，但是它隶属于 PyPA (Python Packaging Authority) 。激活了之后，你可以直接通过 pip 在虚拟环境中安装库。")]),t._v(" "),a("li",[a("strong",[a("a",{attrs:{href:"https://github.com/pyenv/pyenv",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("pyenv")]),a("OutboundLink")],1)]),t._v(" 用来隔离 Python 版本。比如你可能想要在 Python 2.6、2.7、3.3、3.4 和 3.5 中测试你的代码，所以你需要一种在它们之间进行切换的方式。激活之后，它会在 PATH 前面加上 "),a("code",[t._v("~/.pyenv/shims")]),t._v("，这里储存了一些 Python 命令程序 ("),a("code",[t._v("python")]),t._v(", "),a("code",[t._v("pip")]),t._v(") 。这些文件不是从系统已有的 Python 中复制出来的，而是专门用来根据环境变量 "),a("code",[t._v("PYENV_VERSION")]),t._v("、"),a("code",[t._v(".python-version")]),t._v(" 文件或者 "),a("code",[t._v("~/.pyenv/version")]),t._v(" 文件来决定使用哪个 Python 版本。pyenv 也简化了下载和安装多个 Python 版本的步骤，使用 "),a("code",[t._v("pyenv install")]),t._v(" 命令即可。")]),t._v(" "),a("li",[a("strong",[a("a",{attrs:{href:"https://pypi.python.org/pypi/pipenv",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("pipenv")]),a("OutboundLink")],1)]),t._v(", 由 Kenneth Reitz 编写 （"),a("code",[t._v("requests")]),t._v(" 的作者）（国内也称作 K 神——译者注），是这个列表当中最新的一个项目。它将 "),a("code",[t._v("Pipfile")]),t._v(", "),a("code",[t._v("pip")]),t._v(" 和 "),a("code",[t._v("virtualenv")]),t._v(" 结合到同一个命令行命令。 "),a("code",[t._v("virtualenv")]),t._v(" 目录一般放在 "),a("code",[t._v("~/.local/share/virtualenvs/XXX")]),t._v(", 其中的 "),a("code",[t._v("XXX")]),t._v(" 是项目目录的 hash。这和 virtualenv 不一样，后者一般放到当前的工作目录。")])])]),t._v(" "),a("li",[t._v("标准库\n"),a("ul",[a("li",[a("strong",[a("a",{attrs:{href:"https://docs.python.org/3/library/venv.html",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("venv")]),a("OutboundLink")],1)]),t._v(" 是 Python 3 内置的一个包（从 Python 3.3 版开始——译者注）。你可以通过 "),a("code",[t._v("python3 -m venv")]),t._v(" 来运行它。它的目标和实现方式都和 "),a("code",[t._v("virtualenv")]),t._v(" 非常类似，只不过它不需要复制 Python 二进制文件（Windows 除外）。除非你要使用 Python2，不然你应该选择 "),a("code",[t._v("venv")]),t._v("。不过截止本文时，Python 社区更喜欢 "),a("code",[t._v("virtualenv")]),t._v(" ，"),a("code",[t._v("venv")]),t._v(" 并没有什么声音。")])])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://ws3.sinaimg.cn/large/0069RVTdgy1fv5thb7akng30sg0fzhe9.gif",alt:"venv 的心情如图"}})]),t._v(" "),a("blockquote",[a("p",[t._v("↑ venv 的心情如图")])]),t._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("p",[t._v("官方文章的 "),a("a",{attrs:{href:"https://pipenv.readthedocs.io/en/latest/install/#installing-pipenv",target:"_blank",rel:"noopener noreferrer"}},[t._v("Installing Pipenv"),a("OutboundLink")],1),t._v(" 一章有好几种安装的方式。在不是很重要的机器上（比如自己的开发机）可以直接使用 "),a("code",[t._v("pip install pipenv")]),t._v(" 进行安装。但是如果在生产环境上安装，就需要其他方式。这里我介绍一下 "),a("a",{attrs:{href:"https://pip.pypa.io/en/stable/user_guide/#user-installs",target:"_blank",rel:"noopener noreferrer"}},[t._v("User Installs"),a("OutboundLink")],1),t._v(" 的方式。这种方式虽然有点繁琐，但是胜在安全，不会影响已有的 Python 环境。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("superman@server ~ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ pip3 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" --user pipenv\n    100% "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("████████████████████████████████"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 5.0MB 314kB/s\nSuccessfully installed pipenv-2018.7.1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("superman@server ~ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("which")]),t._v(" pipenv\npipenv not found\n")])])]),a("p",[t._v("注意此时由于没有修改 "),a("code",[t._v("PATH")]),t._v("（环境变量），所以还需要找到用户目录并修改并将下面的 "),a("code",[t._v("bin")]),t._v(" 目录加入 "),a("code",[t._v("PATH")]),t._v(" 中。")]),t._v(" "),a("p",[t._v("在 Linux 和 macOS 下，用户目录可以使用 "),a("code",[t._v("python -m site --user-base")]),t._v(" 命令获得：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("superman@server ~ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ python3 -m site --user-base\n/home/superman/.local\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("superman@server ~ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("export")]),t._v(" PATH"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PATH")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("python3 -m site --user-base"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("/bin\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("superman@server ~ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("which")]),t._v(" pipenv\n/home/superman/.local/bin/pipenv\n")])])]),a("p",[t._v("为了方便起见，大家可以修改 "),a("code",[t._v("~/.profile")]),t._v(" 或 "),a("code",[t._v("~/.bashrc")]),t._v(" 或者类型的文件，加入上面设置 "),a("code",[t._v("PATH")]),t._v(" 的语言，让 shell 在每次登录的时候自动设置 "),a("code",[t._v("PATH")]),t._v("。")]),t._v(" "),a("p",[t._v("同时为了避免不同的工具链之间的相互影响，通过 User Install 方式安装的「工具链」（比如 virtualenv、pyenv 和 tox）要尽可能少。")]),t._v(" "),a("h2",{attrs:{id:"基本用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本用法","aria-hidden":"true"}},[t._v("#")]),t._v(" 基本用法")]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("pipenv install <packagename>")]),t._v(" 安装包。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cd")]),t._v(" myproj\n$ pipenv "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" requests\n\nUsing /usr/bin/python3 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("3.5.2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" to create virtualenv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nVirtualenv location: /root/.local/share/virtualenvs/myproj-y53uuyLx\nCreating a Pipfile "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" this project"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\nAdding requests to Pipfile's "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("packages"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nPipfile.lock not found, creating"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nUpdated Pipfile.lock "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0b4483"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\nInstalling dependencies from Pipfile.lock "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0b4483"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),a("p",[t._v("在第一次执行 "),a("code",[t._v("pipenv install")]),t._v(" 的时候，Pipenv 会做这么几件事情：")]),t._v(" "),a("ol",[a("li",[t._v("创建 virtualenv 环境")]),t._v(" "),a("li",[t._v("创建 "),a("code",[t._v("Pipfile")]),t._v(" 文件")]),t._v(" "),a("li",[t._v("创建 "),a("code",[t._v("Pipfile.lock")]),t._v(" 文件")]),t._v(" "),a("li",[t._v("安装依赖")])]),t._v(" "),a("p",[t._v("其他常用命令:")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("pipenv install")]),t._v("：安装 "),a("code",[t._v("Pipfile")]),t._v(" 中 "),a("code",[t._v("[packages]")]),t._v(" 下面的包")]),t._v(" "),a("li",[a("code",[t._v("pipenv install --dev")]),t._v("：安装 "),a("code",[t._v("Pipfile")]),t._v(" 中 "),a("code",[t._v("[packages]")]),t._v(" 和 "),a("code",[t._v("[dev-packages]")]),t._v(" 下面的包")]),t._v(" "),a("li",[a("code",[t._v("pipenv install <package>")]),t._v("：在当前环境安装包，并将相关信息写入 "),a("code",[t._v("Pipfile")]),t._v(" 的 "),a("code",[t._v("[packages]")]),t._v(" 和 "),a("code",[t._v("Pipfile.lock")])]),t._v(" "),a("li",[a("code",[t._v("pipenv install <package> --dev")]),t._v("：在当前环境安装包，并将相关信息写入 "),a("code",[t._v("Pipfile")]),t._v(" 的 "),a("code",[t._v("[dev-packages]")]),t._v(" 和 "),a("code",[t._v("Pipfile.lock")])]),t._v(" "),a("li",[a("code",[t._v("pipenv uninstall <package>")]),t._v(": 在当前环境卸载包，并将相关信息从 "),a("code",[t._v("Pipfile")]),t._v(" 和 "),a("code",[t._v("Pipfile.lock")]),t._v(" 中移除")]),t._v(" "),a("li",[a("code",[t._v("pipenv lock")]),t._v("：确认 "),a("code",[t._v("Pipfile")]),t._v(" 中所有包已安装，并根据安装版本生成 "),a("code",[t._v("Pipfile.lock")])]),t._v(" "),a("li",[a("code",[t._v("pipenv --rm")]),t._v("：删除 virtualenv 环境")]),t._v(" "),a("li",[a("code",[t._v("pipenv --venv")]),t._v("：输出当前 virtualenv 环境的路径")]),t._v(" "),a("li",[a("code",[t._v("pipenv shell")]),t._v("：进入虚拟环境，类似 venv 和 virtualenv 的 "),a("code",[t._v("source ./venv/bin/activate")])]),t._v(" "),a("li",[a("code",[t._v("pipenv run <command>")]),t._v(": 使用虚拟环境跑一些命令，比如 "),a("code",[t._v("pipenv run pip3 list")])])]),t._v(" "),a("h2",{attrs:{id:"pipenv-解决了哪些问题？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pipenv-解决了哪些问题？","aria-hidden":"true"}},[t._v("#")]),t._v(" Pipenv 解决了哪些问题？")]),t._v(" "),a("h3",{attrs:{id:"虚拟环境和-pip-不能同时使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#虚拟环境和-pip-不能同时使用","aria-hidden":"true"}},[t._v("#")]),t._v(" 虚拟环境和 pip 不能同时使用")]),t._v(" "),a("p",[t._v("venv 和 virtualenv 可以提供独立的 Python 环境，这是一个非常必要的功能。但是每次进入和退出环境都需要手动地执行命令，非常繁琐而且容易出错。")]),t._v(" "),a("p",[t._v("举个例子，"),a("code",[t._v("projectA")]),t._v(" 和 "),a("code",[t._v("projectB")]),t._v(" 各有一个 venv 环境（位置是两个项目下的 "),a("code",[t._v(".venv")]),t._v(" 目录），我想在两个 venv 环境中安装不同版本的库，正确的做法是下面这样的：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cd")]),t._v(" projectA\n$ "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(".")]),t._v(" .venv/bin/active\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("venv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" $ pip3 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" requests"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v("2.0  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装在 projectA/.venv/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("venv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" $ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/projectB\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("venv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" $ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("which")]),t._v(" pip3\n/tmp/projectA/venv/bin/pip3\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("venv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" $ deactive\n$ "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(".")]),t._v(" .venv/bin/active\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("venv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" $ pip3 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" requests"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v("2.1  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装在 projectB/.venv/")]),t._v("\n")])])]),a("p",[t._v("可以看到，"),a("strong",[t._v("切换目录并不会自动地切换 venv 环境")]),t._v("。这样不仅繁琐，而且容易造成失误，因为我可能没有注意到我所在的目录和使用的 venv/virtualenv 环境不同。")]),t._v(" "),a("p",[t._v("使用 Pipenv 的话，就能解决这个问题了，这也是诸如 npm 等其他包管理器的行为。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cd")]),t._v(" projectA\n$ pipenv "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" requests"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v("2.0  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装在 ~/.local/share/virtualenvs/projectA-OOSnJKux/")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/projectB\n$ pipenv "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" requests"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v("2.1  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装在 ~/.local/share/virtualenvs/projectB-XaGlAV6H/")]),t._v("\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cd")]),t._v(" projectA\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" express-generator@4.0  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装在 projectA/node_modules/")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/projectB\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" express-generator@4.2  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装在 projectB/node_modules/")]),t._v("\n")])])]),a("p",[t._v("扩展阅读："),a("a",{attrs:{href:"https://www.kennethreitz.org/essays/a-better-pip-workflow",target:"_blank",rel:"noopener noreferrer"}},[t._v("A Better Pip Workflow™"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"pip-不能精确地指定版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pip-不能精确地指定版本","aria-hidden":"true"}},[t._v("#")]),t._v(" pip 不能精确地指定版本")]),t._v(" "),a("p",[t._v("今天在开发 Python 项目的时候，一般会使用一个 "),a("code",[t._v("requirements.txt")]),t._v(" 文件来保存依赖信息，这也是标准的做法。而 "),a("code",[t._v("requirements.txt")]),t._v(" 有两种使用方法：")]),t._v(" "),a("p",[t._v("第一种方式，只保存顶级依赖：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ cat requirements.txt\nrequests[security]\nflask\ngunicorn==19.4.5\n")])])]),a("p",[t._v("因为依赖及其子依赖版本并没有被固定下来，在执行 "),a("code",[t._v("pip install -r requirements.txt")]),t._v(" 时会有不同的结果，可能会造成一些问题。")]),t._v(" "),a("p",[t._v("第二种方式，")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ cat requirements.txt\ncffi==1.5.2\ncryptography==1.2.2\nenum34==1.1.2\nFlask==0.10.1\ngunicorn==19.4.5\nidna==2.0\nipaddress==1.0.16\nitsdangerous==0.24\nJinja2==2.8\nMarkupSafe==0.23\nndg-httpsclient==0.4.0\npyasn1==0.1.9\npycparser==2.14\npyOpenSSL==0.15.1\nrequests==2.9.1\nsix==1.10.0\nWerkzeug==0.11.4\n")])])]),a("p",[t._v("这种方式所有的依赖，包括项目的依赖、和依赖的依赖，而且每个依赖都精确到具体的版本，这也是当前 Python 社区的最佳实践。顺便一提这些信息可以使用 "),a("code",[t._v("pip freeze")]),t._v(" 命令输出。但是使用这种方式，管理起来不方便，没有办法很好的分清楚哪些依赖是项目直接需要的，哪些依赖是子依赖。尤其是在升级依赖版本的时候，这种混乱会造成很多困难。")]),t._v(" "),a("p",[t._v("Pipenv 的解决方案是 "),a("code",[t._v("Pipfile")]),t._v(" 和 "),a("code",[t._v("Pipfile.lock")]),t._v(" ，使用它们来替代老旧过时的 "),a("code",[t._v("requirements.txt")])]),t._v(" "),a("h4",{attrs:{id:"pipfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pipfile","aria-hidden":"true"}},[t._v("#")]),t._v(" Pipfile")]),t._v(" "),a("p",[a("code",[t._v("Pipfile")]),t._v(" 使用了 "),a("a",{attrs:{href:"https://github.com/toml-lang/toml",target:"_blank",rel:"noopener noreferrer"}},[t._v("TOML"),a("OutboundLink")],1),t._v(" 格式而不是 "),a("code",[t._v("requirements.txt")]),t._v(" 的纯文本，其中储存了生产环境("),a("code",[t._v("[packages]")]),t._v(")和开发环境("),a("code",[t._v("[dev-packages]")]),t._v(")下所需要的顶级依赖。下面有个简单的例子")]),t._v(" "),a("div",{staticClass:"language-TOML extra-class"},[a("pre",{pre:!0,attrs:{class:"language-toml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[t._v("url")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://pypi.python.org/simple"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[t._v("verify_ssl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pypi"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("packages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[t._v("requests")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token table class-name"}},[t._v("dev-packages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[t._v("pytest")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n")])])]),a("h4",{attrs:{id:"pipfile-lock"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pipfile-lock","aria-hidden":"true"}},[t._v("#")]),t._v(" Pipfile.lock")]),t._v(" "),a("p",[a("code",[t._v("Pipfile.lock")]),t._v(" 实际上是一个 JSON 文件，保存着所有的依赖的版本和 hash 信息。这个文件应该提交到 git 仓库里（除非你同时面向多个 Python 版本开发），而且在任何情况下，都不应该手动地修改这个文件。")]),t._v(" "),a("p",[t._v("一个 "),a("code",[t._v("Pipfile.lock")]),t._v(" 文件的例子：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"_meta"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hash"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"sha256"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8d14434df45e0ef884d6c3f6e8048ba72335637a8631cc44792f52fd20b6f97a"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"host-environment-markers"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"implementation_name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cpython"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"implementation_version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.6.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"os_name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"posix"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"platform_machine"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"x86_64"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"platform_python_implementation"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CPython"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"platform_release"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"16.7.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"platform_system"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Darwin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"platform_version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Darwin Kernel Version 16.7.0: Thu Jun 15 17:36:27 PDT 2017; root:xnu-3789.70.16~2/RELEASE_X86_64"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"python_full_version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.6.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"python_version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.6"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"sys_platform"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"darwin"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"pipfile-spec"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"requires"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"sources"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pypi"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"url"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://pypi.python.org/simple"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"verify_ssl"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"default"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"certifi"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hashes"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sha256:54a07c09c586b0e4c619f02a5e94e36619da8e2b053e20f594348c0611803704"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sha256:40523d2efb60523e113b44602298f0960e900388cf3bb6043f645cf57ea9e3f5"')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"==2017.7.27.1"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"chardet"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hashes"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sha256:fc323ffcaeaed0e0a02bf4d117757b98aed530d9ed4531e3e15460124c106691"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sha256:84ab92ed1c4d4f16916e05906b6b75a6c0fb5db821cc65e70cbd64a3e2a5eaae"')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"==3.0.4"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"idna"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hashes"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sha256:8c7309c718f94b3a625cb648ace320157ad16ff131ae0af362c9f21b80ef6ec4"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sha256:2c6a5de3089009e3da7c5dde64a141dbc8551d5b7f6cf4ed7c2568d0cc520a8f"')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"==2.6"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"requests"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hashes"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sha256:6a1b267aa90cac58ac3a765d067950e7dbbf75b1da07e895d1f594193a40a38b"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sha256:9c443e7324ba5b85070c4a818ade28bfabedf16ea10206da1132edaa6dda237e"')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"==2.18.4"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"urllib3"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hashes"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sha256:06330f386d6e4b195fbfc736b297f58c5a892e4440e54d294d7004e3a9bbea1b"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sha256:cc44da8e1145637334317feebd728bd869a35285b93cbb4cca2577da7e62db4f"')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"==1.22"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"develop"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"py"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hashes"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sha256:2ccb79b01769d99115aa600d7eed99f524bf752bba8f041dc1c184853514655a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sha256:0f2d585d22050e90c7d293b6451c83db097df77871974d90efd5a30dc12fcde3"')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"==1.4.34"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"pytest"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hashes"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sha256:b84f554f8ddc23add65c411bf112b2d88e2489fd45f753b1cae5936358bdf314"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sha256:f46e49e0340a532764991c498244a60e3a37d7424a532b3ff1a6a7653f1a403a"')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"==3.2.2"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("code",[t._v("Pipfile.lock")]),t._v(" 默认使用 sha256 算法给每一个包进行 hash，这样可以保证在不安全的网络环境下也能下载到正确的包。")]),t._v(" "),a("p",[a("code",[t._v("Pipfile")]),t._v(" 和 "),a("code",[t._v("Pipfile.lock")]),t._v(" 都应该提交到版本库中。")]),t._v(" "),a("h2",{attrs:{id:"pipenv-的其他特性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pipenv-的其他特性","aria-hidden":"true"}},[t._v("#")]),t._v(" Pipenv 的其他特性")]),t._v(" "),a("h3",{attrs:{id:"为什么-pipenv-使用-virtualenv-而不是标准库中的-venv？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么-pipenv-使用-virtualenv-而不是标准库中的-venv？","aria-hidden":"true"}},[t._v("#")]),t._v(" 为什么 Pipenv 使用 virtualenv 而不是标准库中的 venv？")]),t._v(" "),a("p",[t._v("根据"),a("a",{attrs:{href:"https://github.com/pypa/pipenv/issues/15",target:"_blank",rel:"noopener noreferrer"}},[t._v("这个 issue"),a("OutboundLink")],1),t._v(" 中的讨论，Pipenv 不使用 venv 的原因有两个：一是 Kenneth Reitz 个人更喜欢 virtualenv，二是 Pipenv 用来管理 virtualenv 的库 "),a("a",{attrs:{href:"https://github.com/berdario/pew/pull/173",target:"_blank",rel:"noopener noreferrer"}},[t._v("Pew"),a("OutboundLink")],1),t._v(" 目前"),a("a",{attrs:{href:"https://github.com/berdario/pew/pull/173",target:"_blank",rel:"noopener noreferrer"}},[t._v("还不支持 venv"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"将-virtualenv-环境的位置改为工程目录下"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将-virtualenv-环境的位置改为工程目录下","aria-hidden":"true"}},[t._v("#")]),t._v(" 将 virtualenv 环境的位置改为工程目录下")]),t._v(" "),a("p",[t._v("Pipenv 默认会将 virtualenv 目录创建在 "),a("code",[t._v("~/.local/share/virtualenvs/")]),t._v(" 中，但是"),a("a",{attrs:{href:"https://github.com/pypa/pipenv/issues/1382",target:"_blank",rel:"noopener noreferrer"}},[t._v("很多人希望"),a("OutboundLink")],1),t._v("可以将 virtualenv 目录放在工程目录下。Pipenv 也提供了相应的功能，只要将环境变量中 "),a("code",[t._v("PIPENV_VENV_IN_PROJECT")]),t._v(" 的值设为 "),a("code",[t._v("true")]),t._v("，Pipenv 就会在工程目录下的 "),a("code",[t._v(".venv")]),t._v(" 目录创建 virtualenv 环境。不过 Pipenv 也的确提供了足够的命令用来操作 virtualenv，所以不把 virtualenv 目录放在工程目录下也是可以接受的。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("export")]),t._v(" PIPENV_VENV_IN_PROJECT"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cd")]),t._v(" projectC\n$ pipenv "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\nCreating a virtualenv "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" this project"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nVirtualenv location: /root/projectD/.venv\n$ pipenv --venv\n/root/projectC/.venv\n")])])]),a("p",[t._v("2019-02-13 更新：另外一个简单的办法是在项目根目录下手动创建 "),a("code",[t._v(".venv")]),t._v(" 目录，然后再执行 "),a("code",[t._v("pipenv install")]),t._v("。Pipenv 会自动在工程目录下创建虚拟环境。")]),t._v(" "),a("h3",{attrs:{id:"使用不同版本的-python-程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用不同版本的-python-程序","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用不同版本的 python 程序")]),t._v(" "),a("p",[t._v("Pipfile 中有一个可选的 python_version 字段：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('[requires]\npython_version = "3.7"\n')])])]),a("p",[t._v("Pipenv 会自动地根据这个字段寻找相应的 Python 版本。如果找不到对应版本，而且安装了 pyenv 的情况下，Pipenv 还会询问你是否要使用 pyenv 安装特定版本的 Python，可以说是非常贴心了。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ pipenv install\nWarning: Python 3.7 was not found on your system...\nWould you like us to install CPython 3.7.0 with pyenv? [Y/n]: y\nInstalling CPython 3.7.0 with pyenv (this may take a few minutes)...\n")])])]),a("p",[a("em",[t._v("有空写一篇博客介绍一下 pyenv")])]),t._v(" "),a("h3",{attrs:{id:"自定义脚本快捷命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义脚本快捷命令","aria-hidden":"true"}},[t._v("#")]),t._v(" 自定义脚本快捷命令")]),t._v(" "),a("p",[t._v("Pipenv 支持在 "),a("code",[t._v("Pipefile")]),t._v(" 中的 "),a("code",[t._v("[scripts]")]),t._v(" 表情内添加自定义的脚本命令，并通过 "),a("code",[t._v("pipenv run <shortcut name>")]),t._v(" 的方式在 virtualenv 环境中执行对应的命令，哪怕在之前并没有手动地激活 virtualenv 环境。")]),t._v(" "),a("p",[t._v("比如在 "),a("code",[t._v("Pipefile")]),t._v(" 中添加下面的代码：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('[scripts]\ntest = "python3 -m unittest discover -s ./tests"\ndev = "python3 manage.py runserver 0.0.0.0:8000"\n')])])]),a("p",[t._v("然后执行 "),a("code",[t._v("pipenv run test")]),t._v(" 就相当于执行了 "),a("code",[t._v("pipenv run python3 -m unittest discover -s ./tests")]),t._v("，"),a("code",[t._v("pipenv run dev")]),t._v(" 相当于 "),a("code",[t._v("pipenv run python3 manage.py runserver 0.0.0.0:8000")]),t._v("。非常方便的功能。")]),t._v(" "),a("h2",{attrs:{id:"继续学习-pipenv"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#继续学习-pipenv","aria-hidden":"true"}},[t._v("#")]),t._v(" 继续学习 Pipenv")]),t._v(" "),a("p",[t._v("这篇文章只是一个简要的概述，如果大家希望能够深入了解 Pipenv，可以去看官网的 "),a("a",{attrs:{href:"https://pipenv.readthedocs.io/en/latest/#further-documentation-guides",target:"_blank",rel:"noopener noreferrer"}},[t._v("Further Documentation Guides"),a("OutboundLink")],1),t._v(" 章节，应该可以覆盖绝大多数的使用场景了。")]),t._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("p",[t._v("虽然 virtualenv 不是 Pipenv 发明的，Pipfile 也不是它第一个使用的。但是 Pipenv 能把这些工具集合在一起，再加上极其人性化的设计，是解决 Python 包管理问题的不二之选。Pipenv 完全能配得上 Python 官方给他的褒奖和推荐，推荐大家亲自去使用和感受。")]),t._v(" "),a("hr"),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.creativecommons.org/l/by-nc-nd/2.5/cn/88x31.png",alt:"知识共享协议"}})]),t._v(" "),a("p",[t._v("本文采用"),a("a",{attrs:{href:"http://creativecommons.org/licenses/by-nc-nd/2.5/cn/",target:"_blank",rel:"noopener noreferrer"}},[t._v("知识共享署名-非商业性使用-禁止演绎 2.5 中国大陆许可协议"),a("OutboundLink")],1),t._v("进行许可。")])])},[],!1,null,null,null);s.default=n.exports}}]);