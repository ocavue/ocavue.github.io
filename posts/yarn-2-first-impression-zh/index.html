<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.15.4"><!-- Canonical URL --><link rel="canonical" href="https://ocavue.com/posts/yarn-2-first-impression-zh/"><!-- Primary Meta Tags --><title>Ocavue</title><meta name="title" content="Ocavue"><meta name="description" content="Ocavue's Portfolio"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://ocavue.com/posts/yarn-2-first-impression-zh/"><meta property="og:title" content="Ocavue"><meta property="og:description" content="Ocavue's Portfolio"><meta property="og:image" content="https://ocavue.com/preview.png"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://ocavue.com/posts/yarn-2-first-impression-zh/"><meta property="twitter:title" content="Ocavue"><meta property="twitter:description" content="Ocavue's Portfolio"><meta property="twitter:image" content="https://ocavue.com/preview.png"><script>
"use strict";(()=>{(()=>{let t="theme-toggle";function o(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function l(){let e=localStorage.getItem(t);return e==="dark"||e==="light"?e:null}function n(){return l()||o()}function c(e){e===o()?localStorage.removeItem(t):localStorage.setItem(t,e)}function s(e){let m=document.documentElement;m.classList.toggle("dark",e==="dark"),m.style.colorScheme=e}function r(e){c(e),s(e)}r(n()),window.astroThemeToggle={setTheme:r,getTheme:n}})();})();
</script><link rel="stylesheet" href="/_astro/index.SEaj0x-w.css">
<style>::view-transition-old(root),::view-transition-new(root){animation:none;mix-blend-mode:normal}
</style><script type="module">function m(){return typeof window>"u"?"light":window.astroThemeToggle?.getTheme?.()||"light"}function c(e){typeof window>"u"||window.astroThemeToggle?.setTheme?.(e)}function l(){const e=m();c(e==="light"?"dark":"light")}async function h(e,t,n){const o=document;if(typeof o.startViewTransition!="function"){e();return}await o.startViewTransition(()=>{e()})?.ready;const a=.7,r=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><defs><radialGradient id="toggle-theme-gradient"><stop offset="${a}"/><stop offset="1" stop-opacity="0"/></radialGradient></defs><circle cx="4" cy="4" r="4" fill="url(#toggle-theme-gradient)"/></svg>`,s=`data:image/svg+xml;base64,${window.btoa(r)}`,d=window.innerWidth,g=window.innerHeight,i=Math.ceil(Math.hypot(Math.max(t,d-t),Math.max(n,g-n))/a);document.documentElement.animate({maskImage:[`url('${s}')`,`url('${s}')`],maskRepeat:["no-repeat","no-repeat"],maskPosition:[`${t}px ${n}px`,`${t-i}px ${n-i}px`],maskSize:["0",`${2*i}px`]},{duration:500,easing:"ease-in",pseudoElement:"::view-transition-new(root)"})}function w(e){h(l,e.clientX,e.clientY)}document.getElementById("theme-toggle")?.addEventListener("click",w);
</script>
<script type="module" src="/_astro/page.7qqag-5g.js"></script></head> <body> <header> <nav class="py-8 flex items-center text-xl max-w-screen-md mx-auto px-4"> <a href="/" title="Home" class="flex items-center"> <img src="/favicon.svg" alt="Ocavue" class="size-10"> </a> <span class="flex-1"></span> <span class="flex gap-5"> <a href="/posts" title="Blog" class="inline-flex opacity-50 hover:opacity-100 transition-opacity items-center"> <span>Blog</span> </a> <a href="/chat" title="Chat" class="inline-flex opacity-50 hover:opacity-100 transition-opacity items-center"> <span>Chat</span> </a> <a href="/talks" title="Talks" class="inline-flex opacity-50 hover:opacity-100 transition-opacity items-center"> <span>Talks</span> </a> <a href="https://twitter.com/ocavue" title="Twitter" class="inline-flex opacity-50 hover:opacity-100 transition-opacity items-center" target="_blank"> <span class="i-ph:x-logo size-6 block"></span> </a> <a href="https://github.com/ocavue" title="GitHub" class="inline-flex opacity-50 hover:opacity-100 transition-opacity items-center" target="_blank"> <span class="i-ph:github-logo size-6 block"></span> </a> <button class="inline-flex opacity-50 hover:opacity-100 transition-opacity items-center" id="theme-toggle"><span class="i-ph-sun dark:i-ph-moon size-6 min-w-6 min-h-6 block"></span></button> </span> </nav> </header>  <main class="text-base dark:prose-invert prose prose-truegray max-w-screen-md mx-auto px-4 py-12">  <article> <h1>Yarn 2 使用体验</h1> <span class="opacity-50 text-base"> <time datetime="2020-12-25T00:00:00.000Z"> Dec 25, 2020 </time> </span> <div class="pt-10"> <p>Yarn 是 JavaScript 社区非常流行的包管理工具。在 2020-01-24，Yarn 2 <a href="https://dev.to/arcanis/introducing-yarn-2-4eh1">正式发布了</a>。在观察了一段时间后，我从上个月起将我的几个项目升级到了 Yarn 2。在这篇文章中，我将简短地描述以下我这一个月以来对 Yarn 2 的感受。</p>
<p><em>注意：这不是一篇 Yarn 2 教程，我不会详细地介绍 Yarn 2 的每一个特性。如果你想要了解更多关于 Yarn 2 的信息，请查看 Yarn 2 的<a href="https://yarnpkg.com/">官方文档</a>。</em></p>
<h2 id="plugnplay">Plug’n’Play</h2>
<p>毫无疑问，Yarn 2 最大的特点是它的 Plug’n’Play 系统（以下简称 PnP）。虽然 Yarn 1 也可以使用 PnP，但是 Yarn 2 默认开启了它。</p>
<!-- PnP 如何解决这个问题 -->
<p><code>node_modules</code> 是 Node.js 被广为诟病的一点，Yarn PnP 就是社区尝试替代 <code>node_modules</code> 的一个方案。在第一次安装依赖后，除了 <code>yarn.lock</code>，Yarn 2 还会创建一个 <code>.pnp.js</code> 文件。通过这个文件，Yarn 可以主动地告诉 Node.js 应当在哪个具体的位置找到某一个包，而不是让 Node.js 自己尝试在 <code>node_modules</code> 目录中寻找依赖。通过这种方式，Yarn 可以把所有的包以 zip 的格式储存起来，甚至让不同的工程共用同一份依赖文件，从而减少依赖的体积和加载时间。根据我的实际体验，Yarn PnP 的确很快，令人非常惊艳。</p>
<!-- PnP 带来了什么额外的问题 -->
<p>然而，目前的 Node.js 社区工具几乎都是基于 <code>node_modules</code> 进行开发的。这导致 Yarn PnP 和目前的很多工具都不兼容，比如编辑器。如果你的编辑器无法解析依赖，那么你需要额外的步骤，这包括在你的代码库中增加额外的文件，以及手动配置你编辑器，甚至安装额外的插件。更不用说，截止到今天，Yarn 还只支持 VSCode 和 Vim。</p>
<!-- 我的选择是什么 -->
<p>由于这些不足，虽然考虑到 Yarn PnP 速度很快，我还是回到了 <code>node_modules</code> 的模式（通过在 <code>.yarnrc.yml</code> 中添加 <code>nodeLinker: node-modules</code>）。PnP 很棒，但是我觉得这个世界还没有准备好。</p>
<h2 id="yarnlock-and-yarn-deque">yarn.lock and yarn deque</h2>
<p>Yarn 1 的一个很大的问题是 <code>yarn.lock</code> 中会出现依赖版本的重复和落后的问题。这个问题曾经造成了一些令人非常疑惑的现象。在过去，我一直在使用 Atlassian 公司推出的 <a href="https://github.com/atlassian/yarn-deduplicate"><code>yarn-deduplicate</code></a> 来修复这个问题。Yarn 2 原生支持了 <code>yarn deque</code> 命令，可以说从根本上解决了这个问题。</p>
<h2 id="总结">总结</h2>
<p>总体而言，Yarn 2 还是挺让人满意的。虽然说 PnP 有些超前，但是也兼容了 node_modules。我会在我几个大型工程中继续使用 Yarn 2，并继续观察。</p> </div> </article>  </main> <footer class="pt-10 pb-32 flex items-center justify-center max-w-screen-md mx-auto px-4"> <span class="opacity-50 text-md"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" class="hover:underline">CC BY-NC-SA 4.0</a>
2018-2025 &copy; Ocavue
</span> </footer> </body></html>