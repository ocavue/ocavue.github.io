<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.15.4"><!-- Canonical URL --><link rel="canonical" href="https://ocavue.com/posts/django-translation-tutorial/"><!-- Primary Meta Tags --><title>Ocavue</title><meta name="title" content="Ocavue"><meta name="description" content="Ocavue's Portfolio"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://ocavue.com/posts/django-translation-tutorial/"><meta property="og:title" content="Ocavue"><meta property="og:description" content="Ocavue's Portfolio"><meta property="og:image" content="https://ocavue.com/preview.png"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://ocavue.com/posts/django-translation-tutorial/"><meta property="twitter:title" content="Ocavue"><meta property="twitter:description" content="Ocavue's Portfolio"><meta property="twitter:image" content="https://ocavue.com/preview.png"><script>
"use strict";(()=>{(()=>{let t="theme-toggle";function o(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function l(){let e=localStorage.getItem(t);return e==="dark"||e==="light"?e:null}function n(){return l()||o()}function c(e){e===o()?localStorage.removeItem(t):localStorage.setItem(t,e)}function s(e){let m=document.documentElement;m.classList.toggle("dark",e==="dark"),m.style.colorScheme=e}function r(e){c(e),s(e)}r(n()),window.astroThemeToggle={setTheme:r,getTheme:n}})();})();
</script><link rel="stylesheet" href="/_astro/index.SEaj0x-w.css">
<style>::view-transition-old(root),::view-transition-new(root){animation:none;mix-blend-mode:normal}
</style><script type="module">function m(){return typeof window>"u"?"light":window.astroThemeToggle?.getTheme?.()||"light"}function c(e){typeof window>"u"||window.astroThemeToggle?.setTheme?.(e)}function l(){const e=m();c(e==="light"?"dark":"light")}async function h(e,t,n){const o=document;if(typeof o.startViewTransition!="function"){e();return}await o.startViewTransition(()=>{e()})?.ready;const a=.7,r=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><defs><radialGradient id="toggle-theme-gradient"><stop offset="${a}"/><stop offset="1" stop-opacity="0"/></radialGradient></defs><circle cx="4" cy="4" r="4" fill="url(#toggle-theme-gradient)"/></svg>`,s=`data:image/svg+xml;base64,${window.btoa(r)}`,d=window.innerWidth,g=window.innerHeight,i=Math.ceil(Math.hypot(Math.max(t,d-t),Math.max(n,g-n))/a);document.documentElement.animate({maskImage:[`url('${s}')`,`url('${s}')`],maskRepeat:["no-repeat","no-repeat"],maskPosition:[`${t}px ${n}px`,`${t-i}px ${n-i}px`],maskSize:["0",`${2*i}px`]},{duration:500,easing:"ease-in",pseudoElement:"::view-transition-new(root)"})}function w(e){h(l,e.clientX,e.clientY)}document.getElementById("theme-toggle")?.addEventListener("click",w);
</script>
<script type="module" src="/_astro/page.7qqag-5g.js"></script></head> <body> <header> <nav class="py-8 flex items-center text-xl max-w-screen-md mx-auto px-4"> <a href="/" title="Home" class="flex items-center"> <img src="/favicon.svg" alt="Ocavue" class="size-10"> </a> <span class="flex-1"></span> <span class="flex gap-5"> <a href="/posts" title="Blog" class="inline-flex opacity-50 hover:opacity-100 transition-opacity items-center"> <span>Blog</span> </a> <a href="/chat" title="Chat" class="inline-flex opacity-50 hover:opacity-100 transition-opacity items-center"> <span>Chat</span> </a> <a href="https://twitter.com/ocavue" title="Twitter" class="inline-flex opacity-50 hover:opacity-100 transition-opacity items-center" target="_blank"> <span class="i-ph:x-logo size-6 block"></span> </a> <a href="https://github.com/ocavue" title="GitHub" class="inline-flex opacity-50 hover:opacity-100 transition-opacity items-center" target="_blank"> <span class="i-ph:github-logo size-6 block"></span> </a> <button class="inline-flex opacity-50 hover:opacity-100 transition-opacity items-center" id="theme-toggle"><span class="i-ph-sun dark:i-ph-moon size-6 min-w-6 min-h-6 block"></span></button> </span> </nav> </header>  <main class="text-base dark:prose-invert prose prose-truegray max-w-screen-md mx-auto px-4 py-12">  <article> <h1>Django å¤šè¯­è¨€æ•™ç¨‹ (i18n)</h1> <span class="opacity-50 text-base"> <time datetime="2018-07-03T00:00:00.000Z"> Jul 3, 2018 </time> </span> <div class="pt-10"> <!-- åŸæ–‡é“¾æ¥ï¼šhttps://ocavue.com/django_translation_tutorial.html -->
<h2 id="æ¦‚è§ˆ">æ¦‚è§ˆ</h2>
<p>æœ€è¿‘å…¬å¸å‡†å¤‡æ‰©å¼ æµ·å¤–ä¸šåŠ¡ï¼Œæ‰€ä»¥è¦ç»™ Django ç³»ç»Ÿæ·»åŠ  <strong>å›½é™…åŒ–ä¸æœ¬åœŸåŒ–</strong> æ”¯æŒã€‚å›½é™…åŒ–ä¸€èˆ¬ç®€ç§° <strong>i18n</strong>ï¼Œä»£è¡¨ Internationalization ä¸­ i å’Œ n æœ‰ 18 ä¸ªå­—æ¯ï¼›æœ¬åœ°åŒ–ç®€ç§° <strong>L10n</strong>ï¼Œè¡¨ç¤º Localization ä¸­ l å’Œ n ä¸­æœ‰ 10 ä¸ªå­—æ¯ã€‚æœ‰è¶£çš„ä¸€ç‚¹æ˜¯ï¼Œä¸€èˆ¬ä¼šç”¨å°å†™çš„ i å’Œå¤§å†™çš„ L é˜²æ­¢æ··æ·†ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼ši18n æ˜¯ä¸ºå›½é™…åŒ–æ­å»ºæ¡†æ¶ï¼ŒL10n æ˜¯é’ˆå¯¹ä¸åŒåœ°åŒºçš„é€‚é…ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<p>i18n:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#E1E4E8">datetime.now().strftime(</span><span style="color:#9ECBFF">'%Y/%m/</span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">)  </span><span style="color:#6A737D"># before i18n</span></span>
<span class="line"><span style="color:#E1E4E8">datetime.now().strftime(timeformat)  </span><span style="color:#6A737D"># after i18n</span></span>
<span class="line"></span></code></pre>
<p>L10n:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#E1E4E8">timeformat </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#9ECBFF">    'cn'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'%Y/%m/</span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF">'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    'us'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'%m/</span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF">/%Y'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">    'fr'</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">%d</span><span style="color:#9ECBFF">/%m/%Y'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">    ...</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>æ›´åŠ å…·ä½“çš„å®šä¹‰å¯ä»¥çœ‹ <a href="https://www.w3.org/International/questions/qa-i18n">W3C</a> çš„è§£é‡Šã€‚</p>
<p>i18n çš„èŒƒå›´éå¸¸å¹¿ï¼ŒåŒ…æ‹¬å¤šè¯­è¨€ã€æ—¶åŒºã€è´§å¸å•ä½ã€å•å¤æ•°ã€å­—ç¬¦ç¼–ç ç”šè‡³æ˜¯æ–‡å­—é˜…è¯»é¡ºåºï¼ˆ<a href="https://en.wikipedia.org/wiki/Right-to-left">RTL</a>ï¼‰ç­‰ç­‰ã€‚è¿™ç¯‡æ–‡ç« åªå…³æ³¨ <strong>i18n çš„å¤šè¯­è¨€</strong> æ–¹é¢ã€‚</p>
<p><img src="https://i.loli.net/2019/05/06/5ccfe8a27e378.jpg" alt="ä½¿ç”¨é˜¿æ‹‰ä¼¯è¯­çš„ windows ç³»ç»Ÿï¼Œæ¥æº"></p>
<blockquote>
<p>â†‘ é˜¿æ‹‰ä¼¯è¯­çš„ windows ç³»ç»Ÿï¼Œæ–‡å­—ç”šè‡³ç•Œé¢çš„æ–¹å‘éƒ½ä¸ä¸­æ–‡ç‰ˆçš„ç›¸åï¼ˆ<a href="http://blog.dmitriev.de/Articles/24-JUL-2014-ArabianWindow.html">å›¾ç‰‡æ¥æº</a>ï¼‰</p>
</blockquote>
<h2 id="åŸºæœ¬æ­¥éª¤">åŸºæœ¬æ­¥éª¤</h2>
<p>Django ä½œä¸ºä¸€ä¸ªå¤§è€Œå…¨çš„æ¡†æ¶ï¼Œå·²ç»æä¾›äº†ä¸€å¥—å¤šè¯­è¨€çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ç¨å¾®å¯¹æ¯”äº†ä¸€ä¸‹ï¼Œå¹¶æ²¡èƒ½æ‰¾åˆ°åœ¨ Django ä½“ç³»ä¸‹æ¯”å®˜æ–¹æ–¹æ¡ˆè¿˜å¥½ç”¨çš„åº“ã€‚Django çš„æ–¹æ¡ˆå¯ä»¥ç®€å•åˆ†ä¸ºå››æ­¥ï¼š</p>
<ol>
<li>ä¸€äº›å¿…è¦çš„é…ç½®</li>
<li>åœ¨ä»£ç ä¸­æ ‡è®°éœ€è¦ç¿»è¯‘çš„æ–‡æœ¬</li>
<li>ä½¿ç”¨ <code>makemessages</code> å‘½ä»¤ç”Ÿæˆ po æ–‡ä»¶</li>
<li>ç¼–è¯‘ <code>compilemessages</code> å‘½ä»¤ç¼–è¯‘ mo æ–‡ä»¶</li>
</ol>
<p>ä¸‹é¢æˆ‘ä»¬è¯¦ç»†æ¥çœ‹çœ‹</p>
<h3 id="ç¬¬ä¸€æ­¥é…ç½®">ç¬¬ä¸€æ­¥ï¼šé…ç½®</h3>
<p>é¦–å…ˆåœ¨ settings.py ä¸­åŠ å…¥è¿™å‡ ä¸ªå†…å®¹</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#79B8FF">LOCALE_PATHS</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">    os.path.join(</span><span style="color:#79B8FF">__file__</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'language'</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">MIDDLEWARE</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#79B8FF">    ...</span></span>
<span class="line"><span style="color:#9ECBFF">    'django.middleware.locale.LocaleMiddleware'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">    ...</span></span>
<span class="line"><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#79B8FF">LANGUAGES</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">    (</span><span style="color:#9ECBFF">'en'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'English'</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">    (</span><span style="color:#9ECBFF">'zh'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'ä¸­æ–‡'</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<p><code>LOCALE_PATHS</code>ï¼šæŒ‡å®šä¸‹é¢ç¬¬ä¸‰æ­¥å’Œç¬¬å››æ­¥ç”Ÿæˆæ–‡ä»¶çš„ä½ç½®ã€‚è€ç‰ˆçš„ Django éœ€è¦æ‰‹åŠ¨æ–°å»ºå¥½è¿™ä¸ªç›®å½•ã€‚</p>
<p><code>LocaleMiddleware</code>ï¼šå¯ä»¥è®© Django è¯†åˆ«å¹¶é€‰æ‹©åˆé€‚çš„è¯­è¨€ã€‚</p>
<p><code>LANGUAGES</code>ï¼šæŒ‡å®šäº†è¿™ä¸ªå·¥ç¨‹èƒ½æä¾›å“ªäº›è¯­è¨€ã€‚</p>
<h3 id="ç¬¬äºŒæ­¥æ ‡è®°æ–‡æœ¬">ç¬¬äºŒæ­¥ï¼šæ ‡è®°æ–‡æœ¬</h3>
<p>ä¹‹å‰æ²¡æœ‰å¤šè¯­è¨€çš„éœ€è¦ï¼Œæ‰€ä»¥å¤§å®¶åœ¨ AJAX ç›¸åº”ä»£ç ä¸­ç›´æ¥å†™äº†ä¸­æ–‡ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F97583">return</span><span style="color:#E1E4E8"> JsonResponse({</span><span style="color:#9ECBFF">"msg"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"å†…å®¹è¿‡é•¿"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"code"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"data"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">None</span><span style="color:#E1E4E8">})</span></span>
<span class="line"></span></code></pre>
<p>ç°åœ¨éœ€è¦å¤šè¯­è¨€äº†ï¼Œå°±éœ€è¦å‘Šè¯‰ Django å“ªäº›å†…å®¹æ˜¯éœ€è¦ç¿»è¯‘çš„ã€‚å¯¹äºä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼Œå°±æ˜¯å†™æˆè¿™æ ·ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> django.utils.translation </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> gettext </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> _</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">return</span><span style="color:#E1E4E8"> JsonResponse({</span><span style="color:#9ECBFF">"msg"</span><span style="color:#E1E4E8">: _(</span><span style="color:#9ECBFF">"å†…å®¹è¿‡é•¿"</span><span style="color:#E1E4E8">), </span><span style="color:#9ECBFF">"code"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"data"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">None</span><span style="color:#E1E4E8">})</span></span>
<span class="line"></span></code></pre>
<p>è¿™é‡Œä½¿ç”¨ <code>gettext</code> å‡½æ•°å°†åŸæœ¬çš„å­—ç¬¦ä¸²åŒ…è£¹èµ·æ¥ï¼Œè¿™æ ·çš„è¯ï¼ŒDjango å°±å¯ä»¥æ ¹æ®å½“å‰è¯­è¨€è¿”å›åˆé€‚çš„å­—ç¬¦ä¸²ã€‚ä¸€èˆ¬ä¼šä½¿ç”¨å•ä¸ªä¸‹åˆ’çº¿ <code>_</code> æé«˜å¯è¯»æ€§ã€‚</p>
<p>å› ä¸ºæˆ‘å¸å‡ ä¹æ‰€æœ‰å‰åç«¯é€šä¿¡éƒ½ä½¿ç”¨ AJAXï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰æ€ä¹ˆç”¨ä¸Š Django çš„æ¨¡æ¿åŠŸèƒ½ï¼ˆé¡ºä¾¿ä¸€æï¼Œæˆ‘å¸å‰ç«¯ä½¿ç”¨çš„å¤šè¯­è¨€å·¥å…·æ˜¯ <a href="https://github.com/i18next/i18next">i18next</a>ï¼‰ã€‚ä¸è¿‡åœ¨è¿™é‡Œä¹Ÿä¸€å¹¶å†™ä¸‹ Django æ¨¡æ¿çš„æ ‡è®°æ–¹æ³•ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>&#x3C;title>{% trans "This is the title." %}&#x3C;/title></span></span>
<span class="line"><span>&#x3C;title>{% trans myvar %}&#x3C;/title></span></span>
<span class="line"><span></span></span></code></pre>
<p>å…¶ä¸­ <code>trans</code> æ ‡ç­¾å‘Šè¯‰ Django éœ€è¦ç¿»è¯‘è¿™ä¸ªæ‹¬å·é‡Œé¢çš„å†…å®¹ã€‚æ›´å…·ä½“çš„ç”¨æ³•å¯ä»¥å‚è€ƒ<a href="https://docs.djangoproject.com/en/2.0/topics/i18n/translation/#trans-template-tag">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<h3 id="ç¬¬ä¸‰æ­¥makemessages">ç¬¬ä¸‰æ­¥ï¼š<code>makemessages</code></h3>
<p>åœ¨æ‰§è¡Œè¿™ä¸€æ­¥ä¹‹å‰ï¼Œè¯·å…ˆé€šè¿‡ <code>xgettext --version</code> ç¡®è®¤è‡ªå·±æ˜¯å¦å®‰è£…äº† <a href="https://www.gnu.org/software/gettext/gettext.html">GNU gettext</a>ã€‚GNU gettext æ˜¯ä¸€ä¸ªæ ‡å‡† i18n L10n åº“ï¼ŒDjango å’Œå¾ˆå¤šå…¶ä»–è¯­è¨€å’Œåº“çš„å¤šè¯­è¨€æ¨¡å—éƒ½è°ƒç”¨äº† GNU gettextï¼Œæ‰€ä»¥æ¥ä¸‹æ¥è®²çš„ä¸€äº› Django ç‰¹æ€§å®é™…ä¸Šè¦å½’åŠŸäº GNU gettextã€‚å¦‚æœæ²¡æœ‰å®‰è£…çš„è¯å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•å®‰è£…ï¼š</p>
<p>ubuntu:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> apt</span><span style="color:#9ECBFF"> update</span></span>
<span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> apt</span><span style="color:#9ECBFF"> install</span><span style="color:#9ECBFF"> gettext</span></span>
<span class="line"></span></code></pre>
<p><a href="https://stackoverflow.com/a/33896321">macOS</a>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> brew</span><span style="color:#9ECBFF"> install</span><span style="color:#9ECBFF"> gettext</span></span>
<span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> brew</span><span style="color:#9ECBFF"> link</span><span style="color:#79B8FF"> --force</span><span style="color:#9ECBFF"> gettext</span></span>
<span class="line"></span></code></pre>
<p><a href="https://docs.djangoproject.com/en/2.0/topics/i18n/translation/#gettext-on-windows">windows</a></p>
<p>å®‰è£…å®Œ GNU gettext åï¼Œå¯¹ Django å·¥ç¨‹æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> python3</span><span style="color:#9ECBFF"> manage.py</span><span style="color:#9ECBFF"> makemessages</span><span style="color:#79B8FF"> --local</span><span style="color:#9ECBFF"> en</span></span>
<span class="line"></span></code></pre>
<p>ä¹‹åå¯ä»¥æ‰¾åˆ°ç”Ÿæˆçš„æ–‡ä»¶ï¼š<code>language/en/LC_MESSAGES/django.po</code>ã€‚æŠŠä¸Šé¢å‘½ä»¤ä¸­çš„ <code>en</code> æ›¿æ¢æˆå…¶ä»–è¯­è¨€ï¼Œå°±å¯ä»¥ç”Ÿæˆä¸åŒè¯­è¨€çš„ <code>django.po</code> æ–‡ä»¶ã€‚é‡Œé¢çš„å†…å®¹å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>#: path/file.py:397</span></span>
<span class="line"><span>msgid "è®¢å•å·²åˆ é™¤"</span></span>
<span class="line"><span>msgstr ""</span></span>
<span class="line"><span></span></span>
<span class="line"><span>...</span></span>
<span class="line"><span></span></span></code></pre>
<p>Django ä¼šæ‰¾åˆ°è¢« <code>gettext</code> å‡½æ•°åŒ…è£¹çš„æ‰€æœ‰å­—ç¬¦ä¸²ï¼Œä»¥ <code>msgid</code> çš„å½¢å¼ä¿å­˜åœ¨ <code>django.po</code>ã€‚æ¯ä¸ª <code>msgid</code> ä¸‹é¢çš„ <code>msgstr</code> å°±ä»£è¡¨ä½ è¦æŠŠè¿™ä¸ª <code>msgid</code> ç¿»è¯‘æˆä»€ä¹ˆã€‚é€šè¿‡ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶å¯ä»¥å‘Šè¯‰ Django ç¿»è¯‘çš„å†…å®¹ã€‚åŒæ—¶é€šè¿‡æ³¨é‡Šè¯´æ˜äº†è¿™ä¸ª <code>msgid</code> å‡ºç°åœ¨å“ªä¸ªæ–‡ä»¶çš„å“ªä¸€è¡Œã€‚</p>
<p>å…³äºè¿™ä¸ªæ–‡ä»¶ï¼Œå‘ç°å‡ ç‚¹æœ‰è¶£çš„ç‰¹æ€§ï¼š</p>
<ul>
<li>Django ä¼šæŠŠå¤šä¸ªæ–‡ä»¶ä¸­ç›¸åŒçš„ <code>msgid</code> å½’ç±»åœ¨ä¸€èµ·ã€‚ã€Œä¸€æ¬¡ç¼–è¾‘ï¼Œåˆ°å¤„ç¿»è¯‘ã€</li>
<li>å¦‚æœä»¥åæºç ä¸­æŸä¸ª <code>msgid</code> è¢«åˆ äº†ï¼Œé‚£ä¹ˆå†æ¬¡æ‰§è¡Œ <code>makemessages</code> å‘½ä»¤åï¼Œè¿™ä¸ª <code>msgid</code> å’Œå®ƒçš„ <code>msgstr</code> ä¼šä»¥æ³¨é‡Šçš„å½¢å¼ç»§ç»­ä¿å­˜åœ¨ <code>django.po</code> ä¸­ã€‚</li>
<li>æ—¢ç„¶æºç ä¸­çš„å­—ç¬¦ä¸²åªæ˜¯ä¸€ä¸ªæ‰€è°“çš„ idï¼Œé‚£ä¹ˆæˆ‘å°±å¯ä»¥åœ¨æºç ä¸­å†™æ²¡æœ‰å®é™…å«ä¹‰çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ <code>_("ERROR_MSG42")</code>ï¼Œç„¶åå°† â€œERROR_MSG42â€ åŒæ—¶ç¿»è¯‘æˆä¸­æ–‡å’Œè‹±æ–‡ã€‚</li>
<li>è¿™ä¸ªæ–‡ä»¶ä¸­ä¼šä¿ç•™æ¨¡æ¿å­—ç¬¦ä¸²çš„å ä½ç¬¦ï¼Œæ¯”å¦‚å¯ä»¥ä½¿ç”¨å‘½åå ä½ç¬¦åšåˆ°åœ¨ä¸åŒè¯­è¨€ä¸­ä½¿ç”¨ä¸åŒå ä½ç¬¦é¡ºåºçš„åŠŸèƒ½ï¼Œä¸‹é¢ç»™å‡ºäº†ä¸€ä¸ªä¾‹å­ï¼š</li>
</ul>
<p>py file:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>_('Today is {month} {day}.').format(month=m, day=d)</span></span>
<span class="line"><span>_('Today is %(month)s %(day)s.') % {'month': m, 'day': d}</span></span>
<span class="line"><span></span></span></code></pre>
<p>po file:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>msgid "Today is {month} {day}."</span></span>
<span class="line"><span>msgstr "Aujourd'hui est {day} {month}."</span></span>
<span class="line"><span></span></span>
<span class="line"><span>msgid "Today is %(month)s %(day)s."</span></span>
<span class="line"><span>msgstr "Aujourd'hui est %(day)s %(month)s."</span></span>
<span class="line"><span></span></span></code></pre>
<h3 id="ç¬¬å››æ­¥compilemessages">ç¬¬å››æ­¥ï¼š<code>compilemessages</code></h3>
<p>ä¿®æ”¹å¥½ <code>django.po</code> æ–‡ä»¶åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">$</span><span style="color:#9ECBFF"> python3</span><span style="color:#9ECBFF"> manage.py</span><span style="color:#9ECBFF"> compilemessages</span><span style="color:#79B8FF"> --local</span><span style="color:#9ECBFF"> en</span></span>
<span class="line"></span></code></pre>
<p>Django ä¼šè°ƒç”¨ç¨‹åºï¼Œæ ¹æ® <code>django.po</code> ç¼–è¯‘å‡ºä¸€ä¸ªåä¸º <code>django.mo</code> çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½ç½®å’Œ <code>django.po</code> æ‰€åœ¨ä½ç½®ç›¸åŒã€‚è¿™ä¸ªæ–‡ä»¶æ‰æ˜¯ç¨‹åºæ‰§è¡Œçš„æ—¶å€™ä¼šå»è¯»å–çš„æ–‡ä»¶ã€‚</p>
<p>æ‰§è¡Œå®Œä¸Šé¢å››æ­¥åï¼Œä¿®æ”¹æµè§ˆå™¨çš„è¯­è¨€è®¾ç½®ï¼Œå°±å¯ä»¥çœ‹åˆ° Django çš„ä¸åŒè¾“å‡ºäº†ã€‚</p>
<p><img src="https://i.loli.net/2019/05/06/5ccfe8a63ea5d.jpg" alt="Chrome çš„è¯­è¨€è®¾ç½®"></p>
<blockquote>
<p>â†‘ Chrome çš„è¯­è¨€è®¾ç½®</p>
</blockquote>
<!-- è¿˜æœ‰ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹ï¼Œåœ¨ Django ä¸­ï¼Œå„ä¸ªè¯­è¨€æ˜¯ä¸å¹³ç­‰çš„ã€‚è‹±è¯­ç›¸æ¯”äºå…¶ä»–è¯­è¨€æ¥è¯´ï¼Œæœ‰ç€æ›´é‡è¦çš„ä½ç½®ã€‚æ¯”å¦‚ä¸‹é¢è¿™ç‚¹æ˜¯æœ‰å¤šäºæˆ–ç­‰äºä¸‰ç§è¯­è¨€çš„å·¥ç¨‹éœ€è¦æ³¨æ„çš„

> When an English variant is activated and English strings are missing, the fallback language will not be the [`LANGUAGE_CODE`](https://docs.djangoproject.com/en/2.0/ref/settings/#std:setting-LANGUAGE_CODE) of the project, but the original strings. For example, an English user visiting a site with[`LANGUAGE_CODE`](https://docs.djangoproject.com/en/2.0/ref/settings/#std:setting-LANGUAGE_CODE) set to Spanish and original strings written in Russian will see Russian text rather than Spanish. -->
<h2 id="é«˜çº§ç‰¹æ€§">é«˜çº§ç‰¹æ€§</h2>
<h3 id="i18n_patterns"><code>i18n_patterns</code></h3>
<p>æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥é€šè¿‡ URL æ¥é€‰æ‹©ä¸åŒçš„è¯­è¨€ã€‚è¿™æ ·åšæœ‰å¾ˆå¤šå¥½å¤„ï¼Œæ¯”å¦‚åŒä¸€ä¸ª URL è¿”å›çš„æ•°æ®çš„è¯­è¨€ä¸€å®šæ˜¯ä¸€è‡´çš„ã€‚Django çš„æ–‡æ¡£å°±ä½¿ç”¨äº†è¿™ç§åšæ³•ï¼š</p>
<blockquote>
<p>ç®€ä½“ä¸­æ–‡ï¼š<a href="https://docs.djangoproject.com/zh-hans/2.0/">https://docs.djangoproject.com/zh-hans/2.0/</a></p>
<p>è‹±æ–‡ï¼š<a href="https://docs.djangoproject.com/en/2.0/">https://docs.djangoproject.com/en/2.0/</a></p>
</blockquote>
<p>å…·ä½“çš„åšæ³•æ˜¯åœ¨ URL ä¸­æ·»åŠ  <code>&#x3C;slug:slug></code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#E1E4E8">urlpatterns </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ([</span></span>
<span class="line"><span style="color:#E1E4E8">    path(</span><span style="color:#9ECBFF">'category/&#x3C;slug:slug>/'</span><span style="color:#E1E4E8">, news_views.category),</span></span>
<span class="line"><span style="color:#E1E4E8">    path(</span><span style="color:#9ECBFF">'&#x3C;slug:slug>/'</span><span style="color:#E1E4E8">, news_views.details),</span></span>
<span class="line"><span style="color:#E1E4E8">])</span></span>
<span class="line"></span></code></pre>
<p>è¯¦ç»†çš„åšæ³•å¯ä»¥å‚è€ƒ Django çš„<a href="https://docs.djangoproject.com/en/2.0/topics/i18n/translation/#url-internationalization">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<h3 id="django-å¦‚ä½•å†³å®šä½¿ç”¨å“ªç§è¯­è¨€">Django å¦‚ä½•å†³å®šä½¿ç”¨å“ªç§è¯­è¨€</h3>
<p>æˆ‘ä»¬ä¹‹å‰è®²è¿‡ <code>LocaleMiddleware</code> å¯ä»¥å†³å®šä½¿ç”¨ä½•ç§è¯­è¨€ã€‚å…·ä½“æ¥è¯´ï¼Œ<code>LocaleMiddleware</code> æ˜¯æŒ‰ç…§ä¸‹é¢çš„é¡ºåºï¼ˆä¼˜å…ˆçº§é€’å‡ï¼‰ï¼š</p>
<ul>
<li><code>i18n_patterns</code></li>
<li><code>request.session[settings.LANGUAGE_SESSION_KEY]</code></li>
<li><code>request.COOKIES[settings.LANGUAGE_COOKIE_NAME]</code></li>
<li><code>request.META['HTTP_ACCEPT_LANGUAGE']</code>ï¼Œå³ HTTP è¯·æ±‚ä¸­çš„ <code>Accept-Language</code> header</li>
<li><code>settings.LANGUAGE_CODE</code></li>
</ul>
<p>æˆ‘å¸é€‰æ‹©æŠŠè¯­è¨€ä¿¡æ¯æ”¾åˆ° Cookies ä¸­ï¼Œå½“ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©è¯­è¨€æ—¶ï¼Œå¯ä»¥è®©å‰ç«¯ç›´æ¥ä¿®æ”¹ Cookiesï¼Œè€Œä¸éœ€è¦è¯·æ±‚åå°çš„æŸä¸ªæ¥å£ã€‚æ²¡æœ‰æ‰‹åŠ¨è®¾ç½®è¿‡è¯­è¨€çš„ç”¨æˆ·å°±æ²¡æœ‰è¿™ä¸ª Cookiesï¼Œè·Ÿéšæµè§ˆå™¨è®¾ç½®ã€‚è¯è¯´ <code>settings.LANGUAGE_COOKIE_NAME</code> çš„é»˜è®¤å€¼æ˜¯ <code>django_language</code>ï¼Œå‰ç«¯ä¸æƒ³åœ¨ä»–ä»¬çš„ä»£ç ä¸­å‡ºç° <code>django</code>ï¼Œæ‰€ä»¥æˆ‘åœ¨ <code>settings.py</code> ä¸­æ·»åŠ äº† <code>LANGUAGE_COOKIE_NAME = app_language</code> ğŸ˜‚ã€‚</p>
<p>ä½ ä¹Ÿå¯ä»¥é€šè¿‡ <code>request.LANGUAGE_CODE</code> åœ¨ View ä¸­æ‰‹åŠ¨è·çŸ¥ <code>LocaleMiddleware</code> é€‰ç”¨äº†å“ªç§è¯­è¨€ã€‚ä½ ç”šè‡³å¯ä»¥é€šè¿‡ <code>activate</code> å‡½æ•°æ‰‹åŠ¨æŒ‡å®šå½“å‰çº¿ç¨‹ä½¿ç”¨çš„è¯­è¨€ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> django.utils.translation </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> activate</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">activate(</span><span style="color:#9ECBFF">'en'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span></code></pre>
<h3 id="ugettext">ugettext</h3>
<p>Python2 æ—¶ä»£ï¼Œä¸ºäº†åŒºåˆ†Â unicode strings å’Œ bytestringsï¼Œæœ‰ <code>ugettext</code> å’Œ <code>gettext</code> ä¸¤ä¸ªå‡½æ•°ã€‚åœ¨ Python3 ä¸­ï¼Œç”±äºå­—ç¬¦ä¸²ç¼–ç çš„ç»Ÿä¸€ï¼Œ<code>ugettext</code> å’Œ <code>gettext</code> æ˜¯ç­‰ä»·çš„ã€‚å®˜æ–¹è¯´æœªæ¥å¯èƒ½ä¼šåºŸå¼ƒ <code>ugettext</code>ï¼Œä½†æ˜¯æˆªæ­¢åˆ°ç°åœ¨ï¼ˆDjango 2.0ï¼‰ï¼Œ<code>ugettext</code> è¿˜æ²¡åºŸå¼ƒã€‚</p>
<h3 id="gettext_lazy">gettext_lazy</h3>
<p>è¿™é‡Œå…ˆç”¨ä¸€ä¸ªä¾‹å­ç›´è§‚åœ°çœ‹ä¸€ä¸‹ <code>gettext_lazy</code> å’Œ <code>gettext</code> çš„åŒºåˆ«</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> django.utils.translation </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> gettext, gettext_lazy, activate, get_language</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">gettext_str </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> gettext(</span><span style="color:#9ECBFF">"Hello World!"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">gettext_lazy_str </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> gettext_lazy(</span><span style="color:#9ECBFF">"Hello World!"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">type</span><span style="color:#E1E4E8">(gettext_str))</span></span>
<span class="line"><span style="color:#6A737D"># &#x3C;class 'str'></span></span>
<span class="line"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">type</span><span style="color:#E1E4E8">(gettext_lazy_str))</span></span>
<span class="line"><span style="color:#6A737D"># &#x3C;class 'django.utils.functional.lazy.&#x3C;locals>.__proxy__'></span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"current language:"</span><span style="color:#E1E4E8">, get_language())</span></span>
<span class="line"><span style="color:#6A737D"># current language: zh</span></span>
<span class="line"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8">(gettext_str, gettext_lazy_str)</span></span>
<span class="line"><span style="color:#6A737D"># ä½ å¥½ä¸–ç•Œï¼ ä½ å¥½ä¸–ç•Œï¼</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">activate(</span><span style="color:#9ECBFF">"en"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"current language:"</span><span style="color:#E1E4E8">, get_language())</span></span>
<span class="line"><span style="color:#6A737D"># current language: en</span></span>
<span class="line"><span style="color:#79B8FF">print</span><span style="color:#E1E4E8">(gettext_str, gettext_lazy_str)</span></span>
<span class="line"><span style="color:#6A737D"># ä½ å¥½ä¸–ç•Œï¼ Hello World!</span></span>
<span class="line"></span></code></pre>
<p><code>gettext</code> å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ <code>gettext_lazy</code> è¿”å›çš„æ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡ä¼šåœ¨è¢«ä½¿ç”¨çš„æ—¶å€™ï¼Œæ‰æ ¹æ®å½“å‰çº¿ç¨‹ä¸­è¯­è¨€å†³å®šç¿»è¯‘æˆä»€ä¹ˆæ–‡å­—ã€‚</p>
<p>è¿™ä¸ªåŠŸèƒ½åœ¨ Django çš„ models ä¸­å°¤å…¶çš„æœ‰ç”¨ã€‚å› ä¸º models ä¸­å®šä¹‰å­—ç¬¦ä¸²çš„ä»£ç åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚åœ¨ä¹‹åçš„è¯·æ±‚ä¸­ï¼Œæ ¹æ®è¯­è¨€çš„ä¸åŒï¼Œè¿™ä¸ªæ‰€è°“å­—ç¬¦ä¸²è¦æœ‰ä¸åŒçš„è¡¨ç°ã€‚</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F97583">from</span><span style="color:#E1E4E8"> django.utils.translation </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> gettext_lazy </span><span style="color:#F97583">as</span><span style="color:#E1E4E8"> _</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> MyThing</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">models</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Model</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#E1E4E8">    name </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> models.CharField(</span><span style="color:#FFAB70">help_text</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">_(</span><span style="color:#9ECBFF">'This is the help text'</span><span style="color:#E1E4E8">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> YourThing</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">models</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">Model</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#E1E4E8">    kind </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> models.ForeignKey(</span></span>
<span class="line"><span style="color:#E1E4E8">        ThingKind,</span></span>
<span class="line"><span style="color:#FFAB70">        on_delete</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">models.</span><span style="color:#79B8FF">CASCADE</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFAB70">        related_name</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">'kinds'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#FFAB70">        verbose_name</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">_(</span><span style="color:#9ECBFF">'kind'</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">    )</span></span>
<span class="line"></span></code></pre>
<h3 id="ä½¿ç”¨-ast--fst-ä¿®æ”¹æºç ">ä½¿ç”¨ AST / FST ä¿®æ”¹æºç </h3>
<p>ç”±äºæˆ‘å¸å·¥ç¨‹éå¸¸åºå¤§ï¼ŒäººåŠ›ç»™æ¯ä¸ªå­—ç¬¦ä¸²æ·»åŠ  <code>_( ... )</code> è¿‡äºç¹çã€‚æ‰€ä»¥æˆ‘è¯•å›¾å¯»æ‰¾ä¸€ç§è‡ªåŠ¨åŒ–çš„æ–¹å¼ã€‚</p>
<p>ä¸€å¼€å§‹é€‰æ‹©çš„æ˜¯ Python å†…ç½®çš„ <code>ast</code> (Abstract syntax tree è¯­æ³•æŠ½è±¡æ ‘) æ¨¡å— ã€‚åŸºæœ¬æ€è·¯æ˜¯é€šè¿‡ <code>ast</code> æ‰¾åˆ°å·¥ç¨‹ä¸­çš„æ‰€æœ‰å­—ç¬¦ä¸²ï¼Œå†ç»™è¿™äº›å­—ç¬¦ä¸²æ·»åŠ  <code>_( ... )</code>ã€‚æœ€åæŠŠä¿®æ”¹åçš„è¯­æ³•æ ‘é‡æ–°è½¬ä¸ºä»£ç ã€‚</p>
<p>ä½†æ˜¯ç”±äº <code>ast</code> å¯¹æ ¼å¼ä¿¡æ¯çš„æ”¯æŒä¸ä½³ï¼Œä¿®æ”¹ä»£ç åå®¹æ˜“é€ æˆæ ¼å¼æ··ä¹±ã€‚æ‰€ä»¥æ‰¾åˆ°äº†åä¸º FST (Full Syntax Tree å…¨é¢æŠ½è±¡æ ‘) çš„æ”¹è¿›æ–¹å¼ã€‚æˆ‘é€‰æ‹©çš„ FST åº“æ˜¯ <a href="https://github.com/PyCQA/redbaron"><code>redbaron</code></a>ã€‚æ ¸å¿ƒçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#E1E4E8">root </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> RedBaron(original_code)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">for</span><span style="color:#E1E4E8"> node </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> root.find_all(</span><span style="color:#9ECBFF">"StringNode"</span><span style="color:#E1E4E8">):</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#E1E4E8">        has_chinese_char(node)</span></span>
<span class="line"><span style="color:#F97583">        and</span><span style="color:#F97583"> not</span><span style="color:#E1E4E8"> is_aleady_gettext(node)</span></span>
<span class="line"><span style="color:#F97583">        and</span><span style="color:#F97583"> not</span><span style="color:#E1E4E8"> is_docstring(node)</span></span>
<span class="line"><span style="color:#E1E4E8">    ):</span></span>
<span class="line"><span style="color:#E1E4E8">        node.replace(</span><span style="color:#9ECBFF">"_(</span><span style="color:#79B8FF">{}</span><span style="color:#9ECBFF">)"</span><span style="color:#E1E4E8">.format(node))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">modified_code </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> root.dumps()</span></span>
<span class="line"></span></code></pre>
<p>æˆ‘æŠŠå®Œæ•´çš„ä»£ç æ”¾åˆ°äº† <a href="https://gist.github.com/ocavue/8c4a8ca228ece5f8291572318c45cfd1">Gist</a> ä¸Šï¼Œå› ä¸ºæ˜¯ä¸€ä¸ªä¸€æ¬¡æ€§è„šæœ¬ï¼Œå†™çš„æ¯”è¾ƒéšæ„ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒã€‚</p>
<p>ä½¿ç”¨ <code>redbaron</code> çš„è¿‡ç¨‹ä¸­ä¹Ÿå‘ç°äº†ä¸€äº›é—®é¢˜ï¼Œä¸€å¹¶è®°å½•è¿™é‡Œï¼šæœ€å¤§é—®é¢˜æ˜¯ <code>redbaron</code> <a href="https://github.com/PyCQA/baron/pull/120"><strong>å·²ç»åœæ­¢ç»´æŠ¤</strong></a>äº†ï¼æ‰€ä»¥ä¸èƒ½æ”¯æŒä¸€äº›æ–°è¯­æ³•ï¼Œæ¯”å¦‚ Python3.6 çš„ f-stringã€‚å…¶æ¬¡æ˜¯è¿™ä¸ªåº“å’Œ <code>ast</code> æ ‡å‡†åº“ç›¸æ¯”ï¼Œè¿è¡Œé€Ÿåº¦å¾ˆæ…¢ï¼Œæ¯æ¬¡è·‘è¿™ä¸ªè„šæœ¬æˆ‘çš„ç”µè„‘éƒ½å‘å‡ºäº†é£æœºå¼•æ“èˆ¬çš„å£°éŸ³ã€‚ç¬¬ä¸‰ç‚¹æ˜¯ä¼šäº§ç”Ÿä¸€äº›å¥‡æ€ªçš„æ ¼å¼ï¼š</p>
<p>ä¿®æ”¹å‰:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#E1E4E8">OutStockSheet </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">    1</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'æœªå‡ºåº“'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">    2</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'å·²å‡ºåº“'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">    3</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">'å·²åˆ é™¤'</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>ä¿®æ”¹åï¼ˆ<code>'å·²åˆ é™¤'</code> å³è¾¹çš„æ‹¬å·è·‘åˆ°äº†ä¸‹ä¸€è¡Œï¼‰:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#E1E4E8">OutStockSheet </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#79B8FF">    1</span><span style="color:#E1E4E8">: _(</span><span style="color:#9ECBFF">'æœªå‡ºåº“'</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#79B8FF">    2</span><span style="color:#E1E4E8">: _(</span><span style="color:#9ECBFF">'å·²å‡ºåº“'</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#79B8FF">    3</span><span style="color:#E1E4E8">: _(</span><span style="color:#9ECBFF">'å·²åˆ é™¤'</span></span>
<span class="line"><span style="color:#E1E4E8">)}</span></span>
<span class="line"></span></code></pre>
<p>æœ€åä¸€ç‚¹å€’æ˜¯å¯ä»¥é€šè¿‡æ ¼å¼åŒ–å·¥å…·è§£å†³ï¼Œé—®é¢˜ä¸å¤§ã€‚</p>
<h3 id="utf8--vs-utf-8"><code>utf8 </code> vs <code>utf-8</code></h3>
<p>é¡¹ç›®ä¸­æœ‰äº› py æ–‡ä»¶æ¯”è¾ƒè€ï¼Œåœ¨æ–‡ä»¶å¼€å¤´ä½¿ç”¨äº† <code># coding: utf8</code> çš„æ ‡ç¤ºã€‚å¯¹äº Python æ¥è¯´ï¼Œutf8 æ˜¯ utf-8 çš„åˆ«åï¼Œæ‰€ä»¥æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚Django åœ¨è°ƒç”¨ GNU gettext æ—¶ï¼Œä¼šä½¿ç”¨å‚æ•°æŒ‡å®šç¼–ç ä¸º utf-8ï¼Œä½†æ˜¯ GNU ä¹Ÿä¼šè¯»å–æ–‡ä»¶ä¸­çš„ç¼–ç æ ‡ç¤ºï¼Œè€Œä¸”å®ƒçš„ä¼˜å…ˆçº§æ›´é«˜ã€‚ä¸å¹¸çš„æ˜¯ utf8 å¯¹ GNU gettext æ¥è¯´æ˜¯ä¸€ä¸ªæœªçŸ¥ç¼–ç ï¼Œäºæ˜¯ GNU gettext ä¼šé™çº§ä½¿ç”¨ ASCII ç¼–ç ï¼Œç„¶ååœ¨é‡åˆ°ä¸­æ–‡å­—ç¬¦æ—¶æŠ¥é”™ï¼ˆçœŸç¬¨ï¼ï¼‰ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>$ python3 manage.py makemessages --local en</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>xgettext: ./path/filename.py:1: Unknown encoding "utf8". Proceeding with ASCII instead.</span></span>
<span class="line"><span>xgettext: Non-ASCII comment at or before ./path/filename.py:26.</span></span>
<span class="line"><span></span></span></code></pre>
<p>æ‰€ä»¥æˆ‘éœ€è¦æŠŠ <code># coding: utf8</code> æ”¹æˆ <code># coding: utf-8</code>ï¼Œæˆ–è€…å¹²è„†åˆ æ‰è¿™è¡Œï¼Œåæ­£ Python3 å·²ç»é»˜è®¤ä½¿ç”¨ utf-8 ç¼–ç äº†ã€‚</p>
<h3 id="valueerror-plural-forms-expression-could-be-dangerous">ValueError: plural forms expression could be dangerous</h3>
<p>ç®€å•æ¥è¯´ï¼Œplural forms å°±æ˜¯ GNU gettext æ§åˆ¶è¯­è¨€çš„å•å¤æ•°è¡¨ç°çš„ä¸€ä¸ªé…ç½®ï¼Œè¯¦ç»†çš„è§£é‡Šå¯ä»¥å‚è€ƒ GNU gettext çš„<a href="https://www.gnu.org/savannah-checkouts/gnu/gettext/manual/html_node/Plural-forms.html">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<p>å¦‚æœåœ¨æ“ä½œ Django å·¥ç¨‹çš„æ—¶å€™å‡ºç°äº† <code>ValueError: plural forms expression could be dangerous</code> çš„æŠ¥é”™ï¼Œé‚£ä¹ˆå°±è¯´æ˜ django.po æ–‡ä»¶ä¸­çš„ plural forms é…ç½®çš„ä¸å¯¹ã€‚æˆ‘åœ¨é…ç½®ä¸­æ–‡çš„ç¿»è¯‘æ–‡ä»¶çš„æ—¶å€™é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶é€šè¿‡äº†ä¸‹é¢çš„æ­¥éª¤è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>åˆ é™¤ django.mo æ–‡ä»¶ï¼šåªè¦è¿™ä¸ªæ–‡ä»¶æ²¡è¢«åˆ é™¤ï¼Œæ¯æ¬¡è·‘ manage.py éƒ½ä¼šæŠ¥é”™ï¼ŒåŒ…æ‹¬ <code>makemessages</code> å’Œ <code>compilemessages</code> å‘½ä»¤åœ¨å†…çš„æ“ä½œã€‚</li>
<li>ä¿®æ”¹ django.po æ–‡ä»¶ï¼šæˆ‘æ ¹æ®<a href="https://groups.google.com/forum/#!topic/django-users/KnVGzJAR2xw">è¿™ä¸ªé“¾æ¥</a>ï¼Œå°† zh/LC_MESSAGES/django.po æ–‡ä»¶ä¸­çš„ <code>"Plural-Forms: nplurals=2; plural=(n != 1);\n"</code> æ”¹æˆäº† <code>"Plural-Forms: nplurals=1; plural=0;\n"</code>ã€‚å…¶ä»–çš„éè‹±è¯­è¯­è¨€å¾ˆå¯èƒ½ä¹Ÿéœ€è¦å¯¹è¿™è¡Œä½œå‡ºç›¸åº”çš„ä¿®æ”¹ã€‚</li>
<li>ä½¿ç”¨ <code>compilemessages</code> é‡æ–°ç”Ÿæˆ djanpo.mo æ–‡ä»¶ã€‚</li>
</ol>
<p>ç»è¿‡ä¸Šé¢çš„æ­¥éª¤ä¹‹åï¼Œä»¥åæ‰§è¡Œ <code>makemessages</code> å’Œ <code>compilemessages</code> å‘½ä»¤æ—¶ï¼Œä¸Šé¢ç¬¬ 2 æ­¥ä½œå‡ºçš„ä¿®æ”¹<strong>ä¸ä¼š</strong>è¢«æ›¿æ¢ï¼Œæ‰€ä»¥å¯ä»¥æ”¾å¿ƒå¤§èƒ†åœ°ç”¨ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>Django (å’Œå…¶èƒŒåçš„ GNU gettext) çš„å¤šè¯­è¨€åŠŸèƒ½éå¸¸å…¨é¢ï¼Œå ªç§°åšå¤§ç²¾æ·±ï¼Œæ¯”å¦‚å¤„ç†å•å¤æ•°çš„ <a href="https://docs.djangoproject.com/en/2.0/topics/i18n/translation/#pluralization">ngettext</a>ï¼Œå¤„ç†å¤šä¹‰è¯çš„ <a href="https://docs.djangoproject.com/en/2.0/topics/i18n/translation/#contextual-markers">pgettext</a>ã€‚HTTP å“åº”ä¸­ä½¿ç”¨ç¿»è¯‘åçš„æ–‡æœ¬ï¼ˆ<code>msgstr</code>ï¼‰ï¼Œä½†æ˜¯åœ¨æ—¥å¿—ä¸­ç•™ä¸‹ç¿»è¯‘å‰æ–‡æœ¬ï¼ˆ<code>msgid</code>ï¼‰çš„ <a href="https://docs.djangoproject.com/en/2.0/topics/i18n/translation/#gettext-noop">gettext_noop</a>ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ä¸»è¦è®²äº†æˆ‘åœ¨å®è·µä¸­ç”¨åˆ°çš„åŠŸèƒ½å’Œé‡åˆ°çš„å‘ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©å¤§å®¶äº†è§£ Django å¤šè¯­è¨€çš„åŸºæœ¬ç”¨æ³•ã€‚æ¬¢è¿å¤§å®¶å»<a href="https://juejin.im/post/5b3efc36e51d45197136eb09">æ˜é‡‘</a>è¯„è®ºğŸ‘ã€‚</p> </div> </article>  </main> <footer class="pt-10 pb-32 flex items-center justify-center max-w-screen-md mx-auto px-4"> <span class="opacity-50 text-md"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" class="hover:underline">CC BY-NC-SA 4.0</a>
2018-2025 &copy; Ocavue
</span> </footer> </body></html>